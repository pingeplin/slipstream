### Google Drive Read and Files Download Requirements Summary

Based on the PRD, the Google Drive integration needs to support:
- **Connection**: Successfully connect to Google Drive API (using Application Default Credentials/Service Account).
- **Listing**: List all image files (JPG, PNG) and PDF files within a specified folder.
- **URL Parsing**: Automatically extract the Folder ID from a full Google Drive URL or accept a raw Folder ID.
- **Downloading**: Download the identified files to a local temporary directory for OCR processing.
- **Tracking**: Track processed files to avoid duplicates (using SQLite, though the current task focuses on the basic read/download flow).
- **CLI Interface**: A command `slipstream process --folder <FOLDER_ID_OR_URL>` to trigger this flow.

### TDD Plan: CLI Tool for Google Drive Integration

#### 1. List of Test Scenarios

| Category | Scenario | Description |
| :--- | :--- | :--- |
| **CLI Arguments** | `test_process_folder_required` | Verify `--folder` is a required argument for the `process` command. |
| | `test_folder_id_parsing` | Verify that both raw IDs and URLs are correctly parsed by the CLI before being passed to the client. |
| **Integration Flow** | `test_process_flow_success` | Verify the end-to-end flow: parse URL -> list files -> download files. |
| | `test_process_empty_folder` | Handle cases where the folder contains no supported files. |
| **Error Handling** | `test_invalid_folder_url` | Verify the CLI reports a clear error when an invalid URL is provided. |
| | `test_gdrive_api_error` | Verify the CLI handles Google Drive API errors (e.g., 404, 403) gracefully. |

#### 2. Test Case Descriptions

- **`test_process_folder_required`**
    - **Input**: `slipstream process` (without `--folder`)
    - **Expected Output**: Exit code 2 (or non-zero) and a message indicating `--folder` is missing.
- **`test_folder_id_parsing`**
    - **Input**: `slipstream process --folder https://drive.google.com/drive/folders/XYZ`
    - **Expected Behavior**: Internal call to `GDriveClient.list_files` uses `XYZ`.
- **`test_process_flow_success`** (Mocked Integration)
    - **Input**: Valid Folder ID with 2 images.
    - **Mock**: `GDriveClient.list_files` returns 2 files; `GDriveClient.download_file` is called twice.
    - **Expected Output**: Success message indicating files were processed/downloaded.
- **`test_invalid_folder_url`**
    - **Input**: `slipstream process --folder https://wrong.com/abc`
    - **Expected Output**: Error message "Unsupported URL domain" and non-zero exit code.

#### 3. Suggested Test Organization

```text
tests/
├── test_url_parser.py      # Existing unit tests for URL parsing
├── test_gdrive.py          # Existing unit tests for GDriveClient
└── test_cli.py             # New tests for CLI commands and integration
```

#### 4. Implementation Milestones (TDD Order)

1. **Red**: Write a test in `tests/test_cli.py` that checks for the existence of the `process` command and the `--folder` argument using `click.testing.CliRunner`.
2. **Green**: Implement the `process` command in `src/slipstream/main.py` using `click` or `typer`.
3. **Refactor**: Ensure CLI structure follows best practices.
4. **Red**: Write a test that simulates `slipstream process --folder <URL>` and asserts that `parse_google_id` is called.
5. **Green**: Update the `process` command to use `parse_google_id`.
6. **Red**: Write an integration test (mocking `GDriveClient`) that asserts `list_files` and `download_file` are called when `process` is executed.
7. **Green**: Implement the logic in `process` to instantiate `GDriveClient`, list files, and download them.

#### 5. Edge Cases and Error Scenarios

- **Empty Folder**: The tool should output "No files found in folder" instead of crashing.
- **Partial Success**: If one file fails to download, it should log the error and continue with the next (as per PRD "Continue-on-error mode").
- **Malformed URL**: The `URLParserError` should be caught and presented as a user-friendly error message via the CLI.

#### 6. Checklist of Tasks

- [x] Create `tests/test_cli.py`
- [x] Define `process` command in `src/slipstream/main.py`
- [x] Implement `--folder` argument parsing in CLI
- [x] Integrate `GDriveClient` into the `process` command
- [x] Implement file listing logic in CLI flow
- [x] Implement file downloading logic in CLI flow (to a temporary directory)
- [x] Add error handling for API and parsing errors
- [x] Verify with `slipstream process --folder <ID_OR_URL>`
